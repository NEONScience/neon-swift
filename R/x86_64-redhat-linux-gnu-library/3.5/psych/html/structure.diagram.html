<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Draw a structural equation model specified by two measurement...</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for structure.diagram {psych}"><tr><td>structure.diagram {psych}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Draw a structural equation model specified by two measurement models and a structural model</h2>

<h3>Description</h3>

<p>Graphic presentations of structural equation models are a very useful way to conceptualize sem and confirmatory factor models. Given a measurement model on x (xmodel) and on y (ymodel) as well as a path model connecting x and y (phi), draw the graph.  If the ymodel is not specified, just draw the measurement model (xmodel + phi). If the Rx or Ry matrices are specified, show the correlations between the x variables, or y variables.
</p>
<p>Perhaps even more usefully, the function returns a model appropriate for running directly in the <em>sem package</em> written by John Fox or the <em>lavaan</em> package by Yves Rosseel.    For this option to work directly, it is necessary to specfy that errrors=TRUE. 
</p>
<p>Input can be specified as matrices or the output from  <code><a href="fa.html">fa</a></code>, factanal,  or a rotation package such as <em>GPArotation</em>.
</p>
<p>For symbolic graphs, the input matrices can be character strings or mixtures of character strings and numeric vectors.
</p>
<p>As an option, for those without Rgraphviz installed, <code><a href="structure.diagram.html">structure.sem</a></code> will just create the sem model and skip the graph. (This functionality is now included in <code><a href="structure.diagram.html">structure.diagram</a></code>.)
</p>
<p>structure.diagram will draw the diagram without using Rgraphviz and is probably the preferred option. structure.graph will be removed eventually.
</p>
<p><code><a href="structure.diagram.html">lavaan.diagram</a></code> will draw either cfa or sem results from the lavaan package. It has been tested for  cfa, sem  and mimic type output.  It takes  the output object from  <em>lavaan</em> and then calls <code><a href="structure.diagram.html">structure.diagram</a></code>.
</p>


<h3>Usage</h3>

<pre>
structure.diagram(fx, Phi=NULL,fy=NULL,labels=NULL,cut=.3,errors=FALSE,simple=TRUE,
   regression=FALSE,lr=TRUE,Rx=NULL,Ry=NULL,digits=1,e.size=.1,
    main="Structural model", ...)
structure.graph(fx,  Phi = NULL,fy = NULL, out.file = NULL, labels = NULL, cut = 0.3, 
   errors=TRUE, simple=TRUE,regression=FALSE, size = c(8, 6), 
    node.font = c("Helvetica", 14), edge.font = c("Helvetica", 10), 
    rank.direction = c("RL", "TB", "LR", "BT"), digits = 1, 
     title = "Structural model", ...)
structure.sem(fx,  Phi = NULL, fy = NULL,out.file = NULL, labels = NULL,
     cut = 0.3, errors=TRUE, simple=TRUE,regression=FALSE)
lavaan.diagram(fit,main,e.size=.1,...) 
sem.diagram(fit,main="A SEM from the sem package",...)
sem.graph(fit,out.file=NULL,main= "A SEM from the sem package",...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>fx</code></td>
<td>
<p>a factor model on the x variables. </p>
</td></tr>
<tr valign="top"><td><code>Phi</code></td>
<td>
<p>A matrix of directed relationships.  Lower diagonal values are drawn.  If the upper diagonal values match the lower diagonal, two headed arrows are drawn.  For a single, directed path, just the value may be specified. </p>
</td></tr>
<tr valign="top"><td><code>fy</code></td>
<td>
<p>a factor model on the y variables (can be empty) </p>
</td></tr>
<tr valign="top"><td><code>Rx</code></td>
<td>
<p>The correlation matrix among the x variables</p>
</td></tr>
<tr valign="top"><td><code>Ry</code></td>
<td>
<p>The correlation matrix among the y variables</p>
</td></tr>
<tr valign="top"><td><code>out.file</code></td>
<td>
<p>name a file to send dot language instructions. </p>
</td></tr>
<tr valign="top"><td><code>labels</code></td>
<td>
<p>variable labels if not specified as colnames for the matrices</p>
</td></tr>
<tr valign="top"><td><code>cut</code></td>
<td>
<p>Draw paths for values &gt; cut </p>
</td></tr>
<tr valign="top"><td><code>fit</code></td>
<td>
<p>The output from a lavaan cfa or sem</p>
</td></tr>
<tr valign="top"><td><code>errors</code></td>
<td>
<p>draw an error term for observerd variables </p>
</td></tr>
<tr valign="top"><td><code>simple</code></td>
<td>
<p>Just draw one path per x or y variable </p>
</td></tr>
<tr valign="top"><td><code>regression</code></td>
<td>
<p>Draw a regression diagram (observed variables cause Y)</p>
</td></tr>
<tr valign="top"><td><code>lr</code></td>
<td>
<p>Direction of diagram is from left to right (lr=TRUE, default) or from bottom to top (lr=FALSE) </p>
</td></tr>
<tr valign="top"><td><code>e.size</code></td>
<td>
<p>size of the ellipses in structure.diagram</p>
</td></tr>
<tr valign="top"><td><code>main</code></td>
<td>
<p>main title of diagram</p>
</td></tr>
<tr valign="top"><td><code>size</code></td>
<td>
<p>page size of graphic </p>
</td></tr>
<tr valign="top"><td><code>node.font</code></td>
<td>
<p> font type for graph </p>
</td></tr>
<tr valign="top"><td><code>edge.font</code></td>
<td>
<p>font type for graph </p>
</td></tr>
<tr valign="top"><td><code>rank.direction</code></td>
<td>
<p> Which direction should the graph be oriented </p>
</td></tr>
<tr valign="top"><td><code>digits</code></td>
<td>
<p>Number of digits to draw</p>
</td></tr>
<tr valign="top"><td><code>title</code></td>
<td>
<p> Title of graphic </p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p> other options to pass to Rgraphviz </p>
</td></tr>
</table>


<h3>Details</h3>

<p>The recommended function is structure.diagram which does not use Rgraphviz but which does not produce dot code either.  
</p>
<p>All three structure function return a matrix of commands suitable for using in the sem or lavaan packages.  (Specify errors=TRUE to get code that will run directly in the sem package.)
</p>
<p>The structure.graph output can be directed to an output file for post processing using the dot graphic language but requires that Rgraphviz is installed. 
</p>
<p>lavaan.diagram will create sem, cfa, or mimic diagrams depending upon the lavaan input.
</p>
<p>sem.diagram and sem.graph convert the output from a simple CFA done with the sem package and draw them using structure.diagram or structure.graph.
lavaan.diagram converts the output (fit) from a simple CFA done with the lavaan package and draws them using structure.diagram.
The figure is organized to show the appropriate paths between:
</p>
<p>The correlations between the X variables (if Rx is specified) <br />
The X variables and their latent factors  (if fx is specified) <br />
The latent X and the latent Y (if Phi is specified)  <br />
The latent Y and the observed Y (if fy is specified) <br />
The correlations between the Y variables (if Ry is specified)<br />
</p>
<p>A confirmatory factor model would specify just fx and Phi, a structural model would include fx, Phi, and fy.  The raw correlations could be shown by just including Rx and Ry.
</p>
<p><code><a href="structure.diagram.html">lavaan.diagram</a></code> may be called from the <code><a href="diagram.html">diagram</a></code> function which also will call  <code><a href="fa.diagram.html">fa.diagram</a></code>, <code><a href="omega.graph.html">omega.diagram</a></code> or  <code><a href="iclust.diagram.html">iclust.diagram</a></code>, depending upon the class of the fit.
</p>
<p>Other diagram functions include <code><a href="fa.diagram.html">fa.diagram</a></code>, <code><a href="omega.graph.html">omega.diagram</a></code>.  All of these functions use the various dia functions such as <code><a href="diagram.html">dia.rect</a></code>, <code><a href="diagram.html">dia.ellipse</a></code>, <code><a href="diagram.html">dia.arrow</a></code>, <code><a href="diagram.html">dia.curve</a></code>, <code><a href="diagram.html">dia.curved.arrow</a></code>, and <code><a href="diagram.html">dia.shape</a></code>.
</p>


<h3>Value</h3>

<table summary="R valueblock">
<tr valign="top"><td><code>sem</code></td>
<td>
<p>(invisible) a model matrix (partially) ready for input to John Fox's sem package.  It is of class &ldquo;mod&quot; for prettier output.  </p>
</td></tr>
<tr valign="top"><td><code>lavaan</code></td>
<td>
<p>(invisible) A model specification for the lavaan package.</p>
</td></tr>
<tr valign="top"><td><code>dotfile</code></td>
<td>
<p>If out.file is specified, a dot language file suitable for using in a dot graphics program such as graphviz or Omnigraffle.</p>
</td></tr>
</table>
<p>A graphic structural diagram in the graphics window
</p>


<h3>Author(s)</h3>

<p>William Revelle</p>


<h3>See Also</h3>

  <p><code><a href="fa.diagram.html">fa.graph</a></code>, <code><a href="omega.graph.html">omega.graph</a></code>, <code><a href="sim.structural.html">sim.structural</a></code> to create artificial data sets with particular structural properties.</p>


<h3>Examples</h3>

<pre>

#A set of measurement and structural models
#First set up the various matrices
fx &lt;-  matrix(c(.9,.8,.7,rep(0,9), .6,.7,-.8,rep(0,9),.5,.6,.4),ncol=3)
fy &lt;- matrix(c(.9,.8,.6,rep(0,4),.6,.8,-.7),ncol=2)
Phi &lt;- matrix(c(1,.35,0,0,0,
                .35,1,.5,0,0,
                0,.5, 1,0,0,
                .7,-.6, 0, 1,0,
                .0, 0, .4,0,1 ),ncol=5,byrow=TRUE)
#now draw a number of models 
f1 &lt;- structure.diagram(fx,main = "A measurement model for x")
f2 &lt;- structure.diagram(fx,Phi, main = "A measurement model for x")  
f3 &lt;- structure.diagram(fy=fy, main = "A measurement model for y") 
f4 &lt;- structure.diagram(fx,Phi,fy,main="A structural path diagram")            
f5 &lt;- structure.diagram(fx,Phi,fy,main="A structural path diagram",errors=TRUE)

#a mimic model
fy &lt;- matrix(c(.9,.8,.6,rep(0,4),.6,.8,-.7),ncol=2)
fx &lt;- matrix(c(.6,.5,0,.4),ncol=2)
mimic &lt;- structure.diagram(fx,fy=fy,simple=FALSE,errors=TRUE, main="A mimic diagram")

fy &lt;- matrix(c(rep(.9,8),rep(0,16),rep(.8,8)),ncol=2)
structure.diagram(fx,fy=fy)

#symbolic input
X2 &lt;- matrix(c("a",0,0,"b","e1",0,0,"e2"),ncol=4)
colnames(X2) &lt;- c("X1","X2","E1","E2")
phi2 &lt;- diag(1,4,4)
phi2[2,1] &lt;- phi2[1,2] &lt;- "r"
f2 &lt;- structure.diagram(X2,Phi=phi2,errors=FALSE,main="A symbolic model") 

#symbolic input with error 
X2 &lt;- matrix(c("a",0,0,"b"),ncol=2)
colnames(X2) &lt;- c("X1","X2")
phi2 &lt;- diag(1,2,2)
phi2[2,1] &lt;- phi2[1,2] &lt;- "r"
f3 &lt;- structure.diagram(X2,Phi=phi2,main="an alternative representation",e.size=.4)

#and yet another one
X6 &lt;- matrix(c("a","b","c",rep(0,6),"d","e","f"),nrow=6)
colnames(X6) &lt;- c("L1","L2")
rownames(X6) &lt;- c("x1","x2","x3","x4","x5","x6")
Y3 &lt;- matrix(c("u","w","z"),ncol=1)
colnames(Y3) &lt;- "Y"
rownames(Y3) &lt;- c("y1","y2","y3")
phi21 &lt;- matrix(c(1,0,"r1",0,1,"r2",0,0,1),ncol=3)
colnames(phi21) &lt;- rownames(phi21) &lt;-  c("L1","L2","Y")
f4 &lt;- structure.diagram(X6,phi21,Y3)

###the following example is not run but is included to show how to work with lavaan

library(lavaan)
mod.1 &lt;- 'A =~ A1 + A2 + A3 + A4 + A5
         C =~ C1 + C2 + C3 + C4 + C5
         E =~ E1 +E2 + E3 + E4 +E5'
fit.1 &lt;- sem(mod.1,psychTools::bfi[complete.cases(psychTools::bfi),],std.lv=TRUE)
lavaan.diagram(fit.1)

#compare with
f3 &lt;- fa(psychTools::bfi[complete.cases(psychTools::bfi),1:15],3)
fa.diagram(f3)
         
mod.3 &lt;- 'A =~ A1 + A2 + A3 + A4 + A5
         C =~ C1 + C2 + C3 + C4 + C5
         E =~ E1 +E2 + E3 + E4 +E5
         A ~ age + gender
         C ~ age + gender
         E ~ age + gender'

fit.3 &lt;- sem(mod.3,psychTools::bfi[complete.cases(psychTools::bfi),],std.lv=TRUE)
lavaan.diagram(fit.3, cut=0,simple=FALSE,main="mimic model")

# and finally, a regression model
X7 &lt;- matrix(c("a","b","c","d","e","f"),nrow=6)
f5 &lt;- structure.diagram(X7,regression=TRUE,main = "Regression model")

#and a really messy regession model
x8 &lt;- c("b1","b2","b3")
r8 &lt;- matrix(c(1,"r12","r13","r12",1,"r23","r13","r23",1),ncol=3)
f6&lt;- structure.diagram(x8,Phi=r8,regression=TRUE,main="Regression model")
</pre>

<hr /><div style="text-align: center;">[Package <em>psych</em> version 1.9.12 <a href="00Index.html">Index</a>]</div>
</body></html>
